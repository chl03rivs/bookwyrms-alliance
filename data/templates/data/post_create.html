{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
    <h2><i class="fa-solid fa-pen-nib"></i> New Post</h2>
    <form method="POST" action="{% url 'new_post' post.id %}">
        {% csrf_token %}
        {{ form|crispy }}

        <div>
            <label for="id_category">Category</label>
            <select id="id_category" class="form-control" name="category">
                {% for key, value in form.category.field.choices %}
                    <option value="{{ key }}" {% if form.category.value == key %}selected{% endif %}>
                        {{ value }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div>
            <div class="form-group">
                <label for="book-search">Mention a Book</label>
                <input type="text" id="book-search" class="form-control" placeholder="Search for a book...">
                <ul id="book-results" class="list-group" style="max-height: 200px; overflow-y: scroll; position: absolute; z-index: 1000; width: 100%;"></ul>
            </div>
            
            <!-- Hidden inputs for the selected book's data -->
            <input type="hidden" id="book_title" name="book_title" value="">
            <input type="hidden" id="book_author" name="book_author" value="">
            <input type="hidden" id="book_cover" name="book_cover" value="">
            <input type="hidden" id="book_genre" name="book_genre" value="">
        </div>

        <div>        
            <button type="submit" class="btn loader-button">
                Publish Edits <i class="fa-solid fa-paper-plane"></i>
            </button>
            <button type="button" class="btn btn-danger" onclick="cancelEdit('{{ post.id }}')">Cancel</button>
        </div>
    </form>

    <script src="{% static 'js/books.js' %}"></script>
{% endblock %}
